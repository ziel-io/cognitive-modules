{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cognitive-modules.dev/schema/registry-entry-v1.json",
  "title": "Cognitive Modules Registry Entry",
  "description": "Schema for a single module entry in the Cognitive Modules registry",
  "type": "object",
  
  "required": ["identity", "metadata", "dependencies", "distribution"],
  
  "properties": {
    "identity": {
      "type": "object",
      "description": "Module identity information",
      "required": ["name", "namespace", "version", "spec_version"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "maxLength": 64,
          "description": "Module name, lowercase with hyphens"
        },
        "namespace": {
          "type": "string",
          "description": "Namespace: 'official', 'community', or organization name"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?(\\+[a-zA-Z0-9.]+)?$",
          "description": "Semantic version (e.g., '2.2.0', '2.3.0-beta.1')"
        },
        "spec_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+$",
          "description": "Cognitive Modules specification version (e.g., '2.2')"
        }
      }
    },
    
    "metadata": {
      "type": "object",
      "description": "Module metadata",
      "required": ["description", "author", "tier"],
      "properties": {
        "description": {
          "type": "string",
          "maxLength": 500,
          "description": "English description of the module"
        },
        "description_zh": {
          "type": "string",
          "maxLength": 500,
          "description": "Chinese description (optional)"
        },
        "author": {
          "type": "string",
          "description": "Author name or organization"
        },
        "license": {
          "type": "string",
          "description": "SPDX license identifier (e.g., 'MIT', 'Apache-2.0')"
        },
        "repository": {
          "type": "string",
          "format": "uri",
          "description": "Source repository URL"
        },
        "documentation": {
          "type": "string",
          "format": "uri",
          "description": "Documentation URL"
        },
        "homepage": {
          "type": "string",
          "format": "uri",
          "description": "Project homepage"
        },
        "keywords": {
          "type": "array",
          "items": { "type": "string" },
          "maxItems": 10,
          "description": "Search keywords"
        },
        "tier": {
          "type": "string",
          "enum": ["exec", "decision", "exploration"],
          "description": "Module tier"
        }
      }
    },
    
    "quality": {
      "type": "object",
      "description": "Quality signals and verification status",
      "properties": {
        "conformance_level": {
          "type": "integer",
          "enum": [1, 2, 3],
          "description": "Conformance level per CONFORMANCE.md"
        },
        "test_coverage": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Test coverage ratio"
        },
        "test_vector_pass": {
          "type": "boolean",
          "description": "Whether module passes official test vectors"
        },
        "verified": {
          "type": "boolean",
          "description": "Whether module is verified by trusted party"
        },
        "verified_by": {
          "type": "string",
          "description": "Name of verifying organization"
        },
        "verified_at": {
          "type": "string",
          "format": "date-time",
          "description": "Verification timestamp"
        },
        "downloads_30d": {
          "type": "integer",
          "minimum": 0,
          "description": "Downloads in last 30 days"
        },
        "stars": {
          "type": "integer",
          "minimum": 0,
          "description": "GitHub stars or equivalent"
        },
        "badges": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Quality badges earned"
        },
        "warnings": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Any warnings about this module"
        },
        "deprecated": {
          "type": "boolean",
          "description": "Whether module is deprecated"
        },
        "successor": {
          "type": "string",
          "description": "Recommended replacement module if deprecated"
        }
      }
    },
    
    "dependencies": {
      "type": "object",
      "description": "Runtime and module dependencies",
      "required": ["runtime_min", "modules"],
      "properties": {
        "runtime_min": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Minimum runtime version required"
        },
        "modules": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Dependency module name"
              },
              "version": {
                "type": "string",
                "description": "Version requirement (e.g., '>=1.0.0')"
              },
              "optional": {
                "type": "boolean",
                "default": false,
                "description": "Whether dependency is optional"
              }
            }
          },
          "description": "Required module dependencies"
        }
      }
    },
    
    "distribution": {
      "type": "object",
      "description": "Package distribution information",
      "required": ["tarball", "checksum"],
      "properties": {
        "tarball": {
          "type": "string",
          "format": "uri",
          "description": "Download URL for gzipped tarball"
        },
        "checksum": {
          "type": "string",
          "pattern": "^sha256:[a-f0-9]{64}$",
          "description": "SHA256 checksum with prefix"
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0,
          "description": "Package size in bytes"
        },
        "files": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of files in package"
        },
        "signature": {
          "type": "string",
          "format": "uri",
          "description": "URL to package signature"
        },
        "signing_key": {
          "type": "string",
          "format": "uri",
          "description": "URL to public signing key"
        }
      }
    },
    
    "timestamps": {
      "type": "object",
      "description": "Lifecycle timestamps",
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "Initial publication timestamp"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Last update timestamp"
        },
        "deprecated_at": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Deprecation timestamp, null if not deprecated"
        }
      }
    }
  }
}
